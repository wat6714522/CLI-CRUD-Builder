import { TypeOrmModuleOptions } from '@nestjs/typeorm';
import { ConfigService } from '@nestjs/config';
import * as path from 'path';

export const databaseConfig = async (
  config: ConfigService,
): Promise<TypeOrmModuleOptions> => {
  return {
    type: config.get<'postgres' | 'mysql' | 'mariadb'>('DB_TYPE') as any,
    host: config.get<string>('DB_HOST'),
    port: Number(config.get<string>('DB_PORT')),
    username: config.get<string>('DB_USERNAME'),
    password: config.get<string>('DB_PASSWORD'),
    database: config.get<string>('DB_NAME'),
    synchronize: false,
    entities: [path.join(__dirname, '..', '**', '*.entity.{ts,js}')],
  } as TypeOrmModuleOptions;
};
